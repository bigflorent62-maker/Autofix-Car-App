<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Autofix AI – Diagnosi</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background: linear-gradient(180deg,#2f4f8f,#0c1b2d);
  color:white;
}

.header {
  text-align:center;
  padding:30px;
  font-size:28px;
  font-weight:bold;
}

.chat-container {
  max-width:800px;
  margin:20px auto;
  padding:20px;
}

.message {
  margin-bottom:15px;
  padding:15px;
  border-radius:12px;
}

.user {
  background:#ff8c1a;
  text-align:right;
}

.ai {
  background:#2b3e5f;
}

.input-area {
  display:flex;
  gap:10px;
  margin-top:20px;
}

input {
  flex:1;
  padding:12px;
  border-radius:8px;
  border:none;
}

button {
  padding:12px 20px;
  border:none;
  border-radius:8px;
  background:#ff8c1a;
  color:white;
  cursor:pointer;
}
</style>
</head>
<body>

<div class="header">
Autofix AI – Diagnosi
</div>

<div class="chat-container" id="chat">
</div>

<div class="chat-container input-area">
<input id="userInput" placeholder="Descrivi il problema..." />
<button id="sendBtn">Invia</button>
</div>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("userInput");
const button = document.getElementById("sendBtn");

let history = [];

function addMessage(text, type) {
  const div = document.createElement("div");
  div.className = "message " + type;
  div.innerHTML = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

button.addEventListener("click", sendMessage);
input.addEventListener("keypress", function(e){
  if(e.key === "Enter") sendMessage();
});

async function sendMessage() {
  const text = input.value.trim();
  if(!text) return;

  addMessage(text, "user");
  input.value = "";

  addMessage("Analisi in corso...", "ai");

  try {
    const response = await fetch("https://autofix-car-app.onrender.com/ai", {
      method:"POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({
        problem: text,
        history: history
      })
    });

    const data = await response.json();

    // rimuove "Analisi in corso..."
    chat.removeChild(chat.lastChild);

    addMessage(data.diagnosis, "ai");

    history.push({
      user: text,
      ai: data.diagnosis
    });

  } catch (err) {
    chat.removeChild(chat.lastChild);
    addMessage("Errore durante l'analisi.", "ai");
    console.error(err);
  }
}
</script>

</body>
</html>

